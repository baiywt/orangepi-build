source "${BASH_SOURCE%/*}/include/rockchip64_common.inc"

BOOTBRANCH='branch:v2017.09-rk3588'
OVERLAY_PREFIX="rk356x"

case $BRANCH in

        legacy)
		KERNELBRANCH='branch:linux-5.10-gen-rkr5'
		LINUXCONFIG='linux-rockchip-rk356x-legacy'
		;;
esac

prepare_boot_configuration

family_tweaks_bsp()
{
	:
}

family_tweaks_s() {

	rsync -a --chown=root:root "${EXTER}"/packages/bsp/rk356x/* ${SDCARD}/
	cp "${EXTER}"/cache/sources/orangepi-test "${SDCARD}"/usr/lib/ -rfa
	chroot "${SDCARD}" /bin/bash -c "/usr/local/bin/desktop_login.sh root >/dev/null 2>&1"
	install_wiringop
	if [[ -f ${SDCARD}/etc/pulse/default.pa && ${BOARD} =~ orangepicm4|orangepi3b ]]; then
		sed -i "s/auto-profiles = yes/auto-profiles = no/" ${SDCARD}/usr/share/pulseaudio/alsa-mixer/profile-sets/default.conf

		echo "load-module module-alsa-sink device=hw:0,0 sink_name=AudioCodec-Playback sink_properties=\"device.description='Headphone'\"" >> ${SDCARD}/etc/pulse/default.pa
		echo "load-module module-alsa-sink device=hw:1,0 sink_name=HDMI-Playback sink_properties=\"device.description='HDMI Audio'\"" >> ${SDCARD}/etc/pulse/default.pa
	fi
}
